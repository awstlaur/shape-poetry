<html>
<head>	
	<script type="text/javascript" src="js/canvg/rgbcolor.js"></script> 
	<script type="text/javascript" src="js/canvg/StackBlur.js"></script>
	<script type="text/javascript" src="js/canvg/canvg.js"></script>
	<script type="text/javascript" src="js/camanjs/dist/caman.full.min.js"></script>
	<script type="text/javascript" src="js/image-processing.js"></script>
	<script type="text/javascript">
	function onLoad() {
		/**filter seize takes threshold value (0-255)
			and converts image to b/w:
			for each pixel, pixel white if above threshold,
				(or if already white)
			pixel black if below or equal threshold*/
		Caman.Filter.register('seive', function(threshold){
			var white = 255;
			var black = 0;
			this.process('seive', function(rgba){
				return brightnessSeive(rgba, threshold);
			});
		});
		//load svg into a canvas		
		canvg('phantomCanvas', 'svg-files/shapes1.svg');
		//capture data url
		var phantomCanvas = document.getElementById('phantomCanvas');
		var img = phantomCanvas.toDataURL('image/png');


		var realCanvas = document.getElementById('canvas');
		var ctx = realCanvas.getContext('2d');
	

		Caman(realCanvas, img, function(){
			this.seive(0);
			this.render(renderCallback);
		});

		//do stuff with pixel data
		function renderCallback(){
			/* realCanvas should have a b/w image now */
			
			var imgData = ctx.getImageData(0,0,realCanvas.width, realCanvas.height);
			console.log(imgData);
			var width  = imgData.width;
			var height = imgData.height;
			var data = imgData.data;
			var bitmap = new Array(width);
			for(var i = 0; i < width; i++){
				bitmap[i] = new Array(height);
			}

			// iterate over all pixels based on x and y coordinates
	        for(var y = 0; y < height; y++) {
	          // loop through each column
	          for(var x = 0; x < width; x++) {
	            var red = data[((width * y) + x) * 4];
	            bitmap[x][y] = (red > 0) ? 1 : 0;
	            // var green = data[((width * y) + x) * 4 + 1];
	            // var blue = data[((width * y) + x) * 4 + 2];
	            // var alpha = data[((width * y) + x) * 4 + 3];
	          }
	        }
			console.log(bitmap);
		}
	}
	</script>
</head>
<body onload="onLoad()">
	<canvas id="phantomCanvas" style="display:none"></canvas>
	<canvas id="canvas"></canvas>
	<canvas id="postCanvas"></canvas>

</body>
</html>